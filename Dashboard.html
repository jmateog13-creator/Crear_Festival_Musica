<!DOCTYPE html>
<html lang="ca">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Festival Manager | Oficina Virtual</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&family=Space+Mono:wght@400;700&display=swap"
        rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        'neon-pink': '#ff00ff',
                        'neon-green': '#39ff14',
                        'electric-blue': '#00ffff',
                        'slate-950': '#020617',
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        mono: ['Space Mono', 'monospace'],
                    },
                    animation: {
                        'pulse-fast': 'pulse 1s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    }
                }
            }
        }
    </script>
    <style>
        body {
            background-color: #020617;
            color: #f8fafc;
            scroll-behavior: smooth;
        }

        .fade-in {
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.8s ease-out, transform 0.8s ease-out;
        }

        .fade-in.visible {
            opacity: 1;
            transform: translateY(0);
        }

        .checklist-item.checked {
            background-color: rgba(57, 255, 20, 0.1);
            border-color: rgba(57, 255, 20, 0.5);
            box-shadow: 0 0 15px rgba(57, 255, 20, 0.1);
        }

        .checklist-text.checked {
            color: #39ff14;
            text-decoration: line-through;
            opacity: 0.7;
        }

        ::selection {
            background: #ff00ff;
            color: white;
        }

        /* Card Selection Styles */
        .shop-card {
            transition: all 0.2s;
            border: 2px solid #1e293b;
            position: relative;
            overflow: hidden;
        }

        .shop-card:hover {
            transform: translateY(-5px);
            border-color: #475569;
        }

        .shop-card.selected {
            border-color: #39ff14;
            background: rgba(57, 255, 20, 0.05);
            box-shadow: 0 0 20px rgba(57, 255, 20, 0.2);
        }

        .shop-card.selected .check-icon {
            opacity: 1;
            transform: scale(1);
        }

        .shop-card.disabled {
            opacity: 0.5;
            filter: grayscale(1);
            pointer-events: none;
        }
    </style>
</head>

<body class="antialiased overflow-x-hidden">

    <!-- TIMELINE (ROADMAP) -->
    <div class="fixed top-0 left-0 w-full z-50 bg-slate-950/90 backdrop-blur-md border-b border-white/10 py-3">
        <div
            class="max-w-4xl mx-auto flex justify-between items-center px-4 text-xs md:text-sm font-mono text-slate-400">
            <div class="flex items-center gap-2 text-neon-pink">
                <span
                    class="bg-neon-pink text-black font-bold w-5 h-5 flex items-center justify-center rounded-full">1</span>
                <span>IDEA</span>
            </div>
            <div class="h-px bg-slate-800 w-8 md:w-16"></div>
            <div class="flex items-center gap-2 hover:text-neon-green transition-colors">
                <span class="border border-slate-600 w-5 h-5 flex items-center justify-center rounded-full">2</span>
                <span>CARTELL</span>
            </div>
            <div class="h-px bg-slate-800 w-8 md:w-16"></div>
            <div class="flex items-center gap-2 hover:text-electric-blue transition-colors">
                <span class="border border-slate-600 w-5 h-5 flex items-center justify-center rounded-full">3</span>
                <span>SPOTIFY</span>
            </div>
            <div class="h-px bg-slate-800 w-8 md:w-16"></div>
            <div class="flex items-center gap-2 hover:text-white transition-colors cursor-pointer"
                onclick="document.getElementById('simulator').scrollIntoView({behavior: 'smooth'})">
                <span
                    class="border border-white bg-white text-black w-5 h-5 flex items-center justify-center rounded-full animate-pulse-fast">4</span>
                <span class="text-white font-bold">JUGAR</span>
            </div>
        </div>
    </div>

    <!-- HERO SECTION -->
    <section class="min-h-screen flex flex-col items-center justify-center relative pt-16">
        <div
            class="absolute inset-0 w-full h-full bg-[linear-gradient(to_right,#80808012_1px,transparent_1px),linear-gradient(to_bottom,#80808012_1px,transparent_1px)] bg-[size:24px_24px]">
        </div>
        <div class="z-10 text-center px-4 max-w-4xl fade-in pb-12">
            <span
                class="inline-block py-1 px-3 rounded-full bg-neon-pink/10 text-neon-pink border border-neon-pink/20 text-sm font-mono mb-6 tracking-wider shadow-[0_0_10px_rgba(255,0,255,0.2)]">PROJECTE:
                FESTIVAL MANAGER</span>
            <h1
                class="text-5xl md:text-7xl font-bold tracking-tight mb-6 bg-clip-text text-transparent bg-gradient-to-br from-white via-slate-200 to-slate-500 drop-shadow-sm">
                DISSENYA EL <span
                    class="text-neon-green drop-shadow-[0_0_15px_rgba(74,222,128,0.5)]">FESTIVAL</span><br />DE L'ANY
            </h1>
            <p class="text-slate-400 text-xl max-w-2xl mx-auto mb-10 leading-relaxed">
                La teva missi√≥: Crear la identitat visual, la banda sonora i sobreviure al simulador.
            </p>
            <button onclick="document.getElementById('briefing').scrollIntoView({behavior: 'smooth'})"
                class="cursor-pointer group relative px-8 py-4 bg-white text-black font-bold text-lg rounded-full hover:bg-neon-green transition-all shadow-[0_0_20px_rgba(255,255,255,0.3)] hover:shadow-[0_0_30px_rgba(74,222,128,0.5)] flex items-center gap-2 mx-auto">
                INICIAR MISSI√ì <i data-lucide="arrow-down"
                    class="w-5 h-5 group-hover:translate-y-1 transition-transform"></i>
            </button>
        </div>
    </section>

    <!-- BRIEFING CARDS -->
    <section id="briefing" class="py-20 px-4 bg-slate-950 border-t border-slate-900">
        <div class="max-w-6xl mx-auto fade-in">
            <h2 class="text-3xl font-bold text-white mb-8 text-center uppercase tracking-widest">Fitxa de Missi√≥</h2>
            <div class="grid md:grid-cols-4 gap-4">
                <div
                    class="p-6 bg-slate-900 border border-slate-800 rounded-xl hover:border-neon-pink transition-colors group">
                    <i data-lucide="pen-tool"
                        class="text-slate-500 group-hover:text-neon-pink mb-4 transition-colors"></i>
                    <h3 class="text-white font-bold mb-2">1. Concepte</h3>
                    <p class="text-slate-400 text-sm">Nom original i Logotip.</p>
                </div>
                <div
                    class="p-6 bg-slate-900 border border-slate-800 rounded-xl hover:border-neon-green transition-colors group">
                    <i data-lucide="mic-2"
                        class="text-slate-500 group-hover:text-neon-green mb-4 transition-colors"></i>
                    <h3 class="text-white font-bold mb-2">2. Line-Up</h3>
                    <p class="text-slate-400 text-sm">4 Artistes (1 Cap de Cartell).</p>
                </div>
                <div
                    class="p-6 bg-slate-900 border border-slate-800 rounded-xl hover:border-electric-blue transition-colors group">
                    <i data-lucide="music"
                        class="text-slate-500 group-hover:text-electric-blue mb-4 transition-colors"></i>
                    <h3 class="text-white font-bold mb-2">3. Spotify</h3>
                    <p class="text-slate-400 text-sm">Playlist p√∫blica amb 20 temes.</p>
                </div>
                <div
                    class="p-6 bg-slate-900 border border-slate-800 rounded-xl hover:border-purple-400 transition-colors group">
                    <i data-lucide="qr-code"
                        class="text-slate-500 group-hover:text-purple-400 mb-4 transition-colors"></i>
                    <h3 class="text-white font-bold mb-2">4. QR</h3>
                    <p class="text-slate-400 text-sm">Generat a la web.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- ========================================== -->
    <!--          FESTIVAL SIMULATOR V4             -->
    <!-- ========================================== -->
    <section id="simulator"
        class="min-h-screen py-24 px-4 bg-[#0a0f1e] relative border-t-4 border-neon-green flex flex-col items-center justify-center">
        <!-- Badge -->
        <div
            class="absolute top-0 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-black border-2 border-neon-green text-neon-green px-8 py-2 rounded-full font-bold font-mono tracking-widest shadow-[0_0_30px_rgba(57,255,20,0.3)] uppercase">
            Simulador de Gesti√≥
        </div>

        <div class="w-full max-w-5xl">

            <!-- PROGRESS STEPS -->
            <div id="wizard-steps" class="flex justify-center gap-4 mb-12">
                <div id="step-dot-1" class="w-3 h-3 rounded-full bg-neon-green transition-all"></div>
                <div id="step-dot-2" class="w-3 h-3 rounded-full bg-slate-800 transition-all"></div>
                <div id="step-dot-3" class="w-3 h-3 rounded-full bg-slate-800 transition-all"></div>
            </div>

            <!-- STEP 1: SETUP WINDOW -->
            <div id="window-step-1"
                class="visible bg-slate-900/80 backdrop-blur-md p-8 md:p-12 rounded-3xl border border-slate-700 shadow-2xl relative overflow-hidden">
                <div class="absolute top-0 left-0 w-full h-2 bg-gradient-to-r from-neon-pink to-electric-blue"></div>

                <h2 class="text-4xl font-bold text-white mb-2 text-center">PAS 1: CONFIGURACI√ì</h2>
                <p class="text-slate-400 text-center mb-10">Introdueix les dades reals del teu projecte.</p>

                <div class="space-y-6 max-w-lg mx-auto">
                    <div>
                        <label class="text-xs font-mono text-neon-pink mb-1 block">NOM DEL FESTIVAL</label>
                        <input type="text" id="fest-name" placeholder="Ex: THUNDER FEST"
                            class="w-full bg-black/50 border border-slate-700 rounded-xl p-4 text-lg text-white focus:border-neon-pink focus:outline-none transition-colors">
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div class="col-span-2">
                            <label class="text-xs font-mono text-neon-green mb-1 block">CAP DE CARTELL
                                (HEADLINER)</label>
                            <input type="text" id="artist-1" placeholder="L'artista m√©s important"
                                class="w-full bg-black/50 border border-slate-700 rounded-xl p-3 text-white focus:border-neon-green focus:outline-none transition-colors">
                        </div>
                        <div><input type="text" id="artist-2" placeholder="Artista 2"
                                class="w-full bg-black/50 border border-slate-700 rounded-xl p-3 text-white text-sm focus:border-slate-500 focus:outline-none">
                        </div>
                        <div><input type="text" id="artist-3" placeholder="Artista 3"
                                class="w-full bg-black/50 border border-slate-700 rounded-xl p-3 text-white text-sm focus:border-slate-500 focus:outline-none">
                        </div>
                        <div class="col-span-2"><input type="text" id="artist-4" placeholder="Artista 4 (Obertura)"
                                class="w-full bg-black/50 border border-slate-700 rounded-xl p-3 text-white text-sm focus:border-slate-500 focus:outline-none">
                        </div>
                    </div>
                    <button onclick="goToStep(2)"
                        class="w-full py-4 bg-white text-black font-bold rounded-xl hover:scale-[1.02] active:scale-[0.98] transition-all text-lg mt-4 shadow-lg group">
                        SEG√úENT PAS <i data-lucide="arrow-right"
                            class="inline w-5 h-5 ml-2 group-hover:translate-x-1 transition-transform"></i>
                    </button>
                </div>
            </div>

            <!-- STEP 2: THE EXPANDED SHOP -->
            <div id="window-step-2"
                class="hidden bg-slate-900/80 backdrop-blur-md p-6 md:p-8 rounded-3xl border border-slate-700 shadow-2xl relative">

                <div class="flex flex-col md:flex-row justify-between items-center mb-6 gap-4">
                    <div>
                        <h2 class="text-3xl font-bold text-white">PAS 2: LA BOTIGA</h2>
                        <p class="text-slate-400">Tens 50k. Tot costa 95k. <span class="text-neon-pink font-bold">TRIA
                                B√â.</span></p>
                    </div>
                    <div
                        class="bg-black/90 px-6 py-4 rounded-xl border-2 border-neon-green shadow-[0_0_20px_rgba(57,255,20,0.2)]">
                        <span class="text-slate-400 text-xs font-mono block">PRESSUPOST DISPONIBLE</span>
                        <span class="text-3xl font-mono font-bold text-neon-green" id="budget-display">50.000‚Ç¨</span>
                    </div>
                </div>

                <!-- Season Select -->
                <div class="mb-6 bg-slate-800/50 p-4 rounded-xl flex items-center gap-4">
                    <label class="text-slate-300 font-bold whitespace-nowrap">üìÖ TEMPORADA:</label>
                    <select id="season-select"
                        class="bg-slate-950 text-white p-2 rounded-lg border border-slate-700 w-full focus:outline-none cursor-pointer">
                        <option value="summer">ESTIU (Risc: Onada de Calor ‚òÄÔ∏è)</option>
                        <option value="autumn">TARDOR (Risc: Tempesta ‚õàÔ∏è)</option>
                    </select>
                </div>

                <!-- 8-CARD GRID -->
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">

                    <!-- ESENCIALS -->
                    <div class="shop-card bg-slate-950 p-4 rounded-xl cursor-pointer group"
                        onclick="toggleUpgrade('tent', 15000)">
                        <div class="absolute top-2 right-2 opacity-0 check-icon transition-all scale-50">
                            <div class="bg-neon-green rounded-full p-1"><i data-lucide="check"
                                    class="w-3 h-3 text-black"></i></div>
                        </div>
                        <div class="text-3xl mb-2 group-hover:scale-110 transition-transform">üé™</div>
                        <h4 class="font-bold text-white text-sm">SUPER CARPA</h4>
                        <p class="text-xs text-slate-500 mb-2">Bloqueja la Pluja.</p>
                        <span class="text-neon-pink font-mono font-bold text-sm">15.000‚Ç¨</span>
                        <input type="checkbox" id="upg-tent" class="hidden">
                    </div>

                    <div class="shop-card bg-slate-950 p-4 rounded-xl cursor-pointer group"
                        onclick="toggleUpgrade('water', 10000)">
                        <div class="absolute top-2 right-2 opacity-0 check-icon transition-all scale-50">
                            <div class="bg-neon-green rounded-full p-1"><i data-lucide="check"
                                    class="w-3 h-3 text-black"></i></div>
                        </div>
                        <div class="text-3xl mb-2 group-hover:scale-110 transition-transform">üíß</div>
                        <h4 class="font-bold text-white text-sm">PUNTS AIGUA</h4>
                        <p class="text-xs text-slate-500 mb-2">Bloqueja la Calor.</p>
                        <span class="text-neon-pink font-mono font-bold text-sm">10.000‚Ç¨</span>
                        <input type="checkbox" id="upg-water" class="hidden">
                    </div>

                    <div class="shop-card bg-slate-950 p-4 rounded-xl cursor-pointer group"
                        onclick="toggleUpgrade('power', 10000)">
                        <div class="absolute top-2 right-2 opacity-0 check-icon transition-all scale-50">
                            <div class="bg-neon-green rounded-full p-1"><i data-lucide="check"
                                    class="w-3 h-3 text-black"></i></div>
                        </div>
                        <div class="text-3xl mb-2 group-hover:scale-110 transition-transform">‚ö°</div>
                        <h4 class="font-bold text-white text-sm">GENERADOR</h4>
                        <p class="text-xs text-slate-500 mb-2">Bloqueja Apagades.</p>
                        <span class="text-neon-pink font-mono font-bold text-sm">10.000‚Ç¨</span>
                        <input type="checkbox" id="upg-power" class="hidden">
                    </div>

                    <div class="shop-card bg-slate-950 p-4 rounded-xl cursor-pointer group"
                        onclick="toggleUpgrade('security', 10000)">
                        <div class="absolute top-2 right-2 opacity-0 check-icon transition-all scale-50">
                            <div class="bg-neon-green rounded-full p-1"><i data-lucide="check"
                                    class="w-3 h-3 text-black"></i></div>
                        </div>
                        <div class="text-3xl mb-2 group-hover:scale-110 transition-transform">üõ°Ô∏è</div>
                        <h4 class="font-bold text-white text-sm">SEGURETAT</h4>
                        <p class="text-xs text-slate-500 mb-2">Control de Masses.</p>
                        <span class="text-neon-pink font-mono font-bold text-sm">10.000‚Ç¨</span>
                        <input type="checkbox" id="upg-security" class="hidden">
                    </div>

                    <!-- EXTRAS -->
                    <div class="shop-card bg-slate-950 p-4 rounded-xl cursor-pointer group"
                        onclick="toggleUpgrade('cleaning', 8000)">
                        <div class="absolute top-2 right-2 opacity-0 check-icon transition-all scale-50">
                            <div class="bg-neon-green rounded-full p-1"><i data-lucide="check"
                                    class="w-3 h-3 text-black"></i></div>
                        </div>
                        <div class="text-3xl mb-2 group-hover:scale-110 transition-transform">üßπ</div>
                        <h4 class="font-bold text-white text-sm">NETEJA PRO</h4>
                        <p class="text-xs text-slate-500 mb-2">Evita queixes d'higiene.</p>
                        <span class="text-electric-blue font-mono font-bold text-sm">8.000‚Ç¨</span>
                        <input type="checkbox" id="upg-cleaning" class="hidden">
                    </div>

                    <div class="shop-card bg-slate-950 p-4 rounded-xl cursor-pointer group"
                        onclick="toggleUpgrade('sound', 15000)">
                        <div class="absolute top-2 right-2 opacity-0 check-icon transition-all scale-50">
                            <div class="bg-neon-green rounded-full p-1"><i data-lucide="check"
                                    class="w-3 h-3 text-black"></i></div>
                        </div>
                        <div class="text-3xl mb-2 group-hover:scale-110 transition-transform">üîä</div>
                        <h4 class="font-bold text-white text-sm">SO IMMERSIU</h4>
                        <p class="text-xs text-slate-500 mb-2">Millora els concerts.</p>
                        <span class="text-electric-blue font-mono font-bold text-sm">15.000‚Ç¨</span>
                        <input type="checkbox" id="upg-sound" class="hidden">
                    </div>

                    <div class="shop-card bg-slate-950 p-4 rounded-xl cursor-pointer group"
                        onclick="toggleUpgrade('influencer', 12000)">
                        <div class="absolute top-2 right-2 opacity-0 check-icon transition-all scale-50">
                            <div class="bg-neon-green rounded-full p-1"><i data-lucide="check"
                                    class="w-3 h-3 text-black"></i></div>
                        </div>
                        <div class="text-3xl mb-2 group-hover:scale-110 transition-transform">üì±</div>
                        <h4 class="font-bold text-white text-sm">INFLUENCERS</h4>
                        <p class="text-xs text-slate-500 mb-2">Multiplica el Respecte.</p>
                        <span class="text-purple-400 font-mono font-bold text-sm">12.000‚Ç¨</span>
                        <input type="checkbox" id="upg-influencer" class="hidden">
                    </div>

                    <div class="shop-card bg-slate-950 p-4 rounded-xl cursor-pointer group"
                        onclick="toggleUpgrade('food', 15000)">
                        <div class="absolute top-2 right-2 opacity-0 check-icon transition-all scale-50">
                            <div class="bg-neon-green rounded-full p-1"><i data-lucide="check"
                                    class="w-3 h-3 text-black"></i></div>
                        </div>
                        <div class="text-3xl mb-2 group-hover:scale-110 transition-transform">üçî</div>
                        <h4 class="font-bold text-white text-sm">ZONA FOODIE</h4>
                        <p class="text-xs text-slate-500 mb-2">Genera diners extra.</p>
                        <span class="text-amber-400 font-mono font-bold text-sm">15.000‚Ç¨</span>
                        <input type="checkbox" id="upg-food" class="hidden">
                    </div>

                </div>

                <div class="flex gap-4">
                    <button onclick="goToStep(1)"
                        class="px-6 py-4 bg-slate-800 text-white font-bold rounded-xl hover:bg-slate-700 transition-colors">
                        ENRERE
                    </button>
                    <button onclick="runSimulation()"
                        class="flex-1 py-4 bg-neon-green text-black font-bold rounded-xl hover:scale-[1.02] active:scale-[0.98] transition-all text-lg shadow-[0_0_20px_rgba(57,255,20,0.3)] animate-pulse">
                        CELEBRAR FESTIVAL üöÄ
                    </button>
                </div>
            </div>

            <!-- STEP 3: RESULTS WINDOW -->
            <div id="window-step-3"
                class="hidden bg-slate-900/90 backdrop-blur-md p-8 md:p-12 rounded-3xl border border-slate-700 shadow-2xl text-center">
                <h2 class="text-5xl font-bold mb-2 uppercase tracking-tighter" id="result-title">CALCULANT...</h2>
                <p class="text-xl text-slate-400 mb-8" id="result-subtitle">Analitzant dades...</p>

                <!-- SCOREBOARD -->
                <div class="flex justify-center gap-8 mb-8">
                    <div class="text-center">
                        <div class="text-xs text-slate-500 font-bold mb-1">CALAIX FINAL</div>
                        <div class="text-4xl font-mono font-bold text-amber-400 drop-shadow-lg" id="final-money">0‚Ç¨
                        </div>
                        <div class="h-1 w-full bg-slate-800 mt-2 rounded overflow-hidden">
                            <div id="bar-money" class="h-full bg-amber-400 w-0 transition-all duration-1000"></div>
                        </div>
                    </div>
                    <div class="text-center">
                        <div class="text-xs text-slate-500 font-bold mb-1">RESPECTE</div>
                        <div class="text-4xl font-mono font-bold text-electric-blue drop-shadow-lg" id="final-respect">0
                        </div>
                        <div class="h-1 w-full bg-slate-800 mt-2 rounded overflow-hidden">
                            <div id="bar-respect" class="h-full bg-electric-blue w-0 transition-all duration-1000">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- LOG WINDOW -->
                <div class="bg-black rounded-lg p-4 font-mono text-left text-sm h-64 overflow-y-auto mb-8 border border-white/10 shadow-inner"
                    id="event-log"></div>

                <button onclick="location.reload()"
                    class="px-8 py-3 bg-white text-black font-bold rounded-full hover:bg-slate-200 transition-colors">
                    TORNAR A JUGAR üîÑ
                </button>
            </div>

        </div>
    </section>

    <!-- JS LOGIC -->
    <script>
        lucide.createIcons();
        document.querySelectorAll('.fade-in').forEach(el => new IntersectionObserver(e => e.forEach(en => en.isIntersecting && en.target.classList.add('visible')), { threshold: 0.1 }).observe(el));

        // WIZARD
        function goToStep(step) {
            [1, 2, 3].forEach(i => document.getElementById('window-step-' + i).classList.add('hidden'));
            [1, 2, 3].forEach(i => document.getElementById('step-dot-' + i).classList.replace('bg-neon-green', 'bg-slate-800'));
            document.getElementById('window-step-' + step).classList.remove('hidden');
            for (let i = 1; i <= step; i++) document.getElementById('step-dot-' + i).classList.replace('bg-slate-800', 'bg-neon-green');
        }

        // GAME VARS
        let budget = 50000;
        let upgrades = {
            tent: false, water: false, power: false, security: false,
            cleaning: false, sound: false, influencer: false, food: false
        };

        function toggleUpgrade(id, cost) {
            const cb = document.getElementById('upg-' + id);
            const card = cb.parentElement;

            if (cb.checked) { // SELL
                budget += cost;
                cb.checked = false;
                upgrades[id] = false;
                card.classList.remove('selected');
                card.classList.remove('disabled');
                // Re-enable others if budget allows? Simplified: Just update UI
            } else { // BUY
                if (budget >= cost) {
                    budget -= cost;
                    cb.checked = true;
                    upgrades[id] = true;
                    card.classList.add('selected');
                } else {
                    card.classList.add('animate-pulse');
                    setTimeout(() => card.classList.remove('animate-pulse'), 500);
                }
            }
            document.getElementById('budget-display').innerText = budget.toLocaleString() + '‚Ç¨';

            // Check affordability of others (Visual Only)
            document.querySelectorAll('.shop-card').forEach(c => {
                // Optional: Dim items we can't afford? Left out for simplicity.
            });
        }

        function runSimulation() {
            goToStep(3);
            const festName = document.getElementById('fest-name').value || "NO NAME FEST";
            const artists = [
                document.getElementById('artist-1').value || "Cap de Cartell",
                document.getElementById('artist-2').value || "Artista 2",
                document.getElementById('artist-3').value || "Artista 3",
                document.getElementById('artist-4').value || "Artista 4"
            ];
            const season = document.getElementById('season-select').value;
            const logEl = document.getElementById('event-log');
            logEl.innerHTML = '';

            const addLog = (text, cls) => {
                setTimeout(() => {
                    logEl.innerHTML += `<div class="${cls} mb-2 p-2 rounded bg-white/5 border-l-2 border-white/20">${text}</div>`;
                    logEl.scrollTop = logEl.scrollHeight;
                }, logEl.children.length * 800);
            }

            let respect = 50;
            if (upgrades.influencer) respect += 10; // Passive Boost

            let revenue = 30000;
            if (upgrades.food) {
                revenue += 15000; // Foodie Boost
                addLog(`üçî La **Zona Foodie** est√† plena! Ingressos extra: +15.000‚Ç¨`, 'text-amber-400');
            }
            budget += revenue;

            // SIMULATION EVENTS
            addLog(`üöÄ BENVINGUTS A <strong>${festName}</strong>`, 'text-white font-bold');

            // 1. HYGIENE CHECK (Early)
            if (!upgrades.cleaning && Math.random() > 0.3) {
                addLog(`üí© Els banys estan bruts i no hi ha equip de neteja. La gent es queixa. Respecte -10.`, 'text-red-400');
                respect -= 10;
            }

            // 2. OPENER
            addLog(`üé§ [${artists[3]}] comen√ßa a tocar.`, 'text-slate-400');
            if (upgrades.sound) {
                addLog(`üîä El **So Immersiu** fa que tothom vibri. Gran inici! Respecte +5.`, 'text-neon-green');
                respect += 5;
            } else if (Math.random() > 0.7) {
                addLog(`üîâ El so es talla una mica. La gent de darrere no sent res.`, 'text-slate-500');
                respect -= 5;
            }

            // 3. SEASON DISASTER
            if (season === 'summer' && Math.random() > 0.3) {
                if (upgrades.water) {
                    addLog(`‚òÄÔ∏è ONADA DE CALOR! Els Punts d'Aigua salven vides.`, 'text-neon-green');
                    respect += 10;
                } else {
                    addLog(`ü•µ CALOR EXTREMA! La gent es desmaia. Respecte -20. Cost -3k.`, 'text-red-400');
                    respect -= 20;
                    budget -= 3000;
                }
            } else if (season === 'autumn' && Math.random() > 0.4) {
                if (upgrades.tent) {
                    addLog(`üåßÔ∏è PLUJA! Tothom a la Super Carpa. Salvados!`, 'text-neon-green');
                    respect += 10;
                } else {
                    addLog(`‚òî DILUVI! Tothom xop i marxant. Respecte -25. Cost -5k.`, 'text-red-400');
                    respect -= 25;
                    budget -= 5000;
                }
            }

            // 4. TECH FAIL
            if (Math.random() > 0.6) {
                if (upgrades.power) {
                    addLog(`‚ö° BAIXADA DE TENSI√ì! El Generador aguanta el show.`, 'text-neon-green');
                } else {
                    addLog(`‚ö†Ô∏è APAGADA! Silenci inc√≤mode de 20 minuts. Respecte -15.`, 'text-red-400');
                    respect -= 15;
                }
            }

            // 5. INFLUENCER MOMENT (Viral)
            if (upgrades.influencer && Math.random() > 0.4) {
                addLog(`üì± Els teus Influencers han pujat un TikTok viral amb [${artists[1]}]. Hype pels n√∫vols! Respecte +15.`, 'text-purple-400 font-bold');
                respect += 15;
            }

            // 6. HEADLINER & CROWD
            addLog(`üåü [${artists[0]}] SURT A LO GRAN!`, 'text-electric-blue font-bold');
            if (Math.random() > 0.5) {
                if (upgrades.security) {
                    addLog(`üõ°Ô∏è La gent embogeix per√≤ Seguretat ho controla.`, 'text-neon-green');
                } else {
                    addLog(`üö® CAOS! Invasi√≥ d'escenari. Multa -5.000‚Ç¨.`, 'text-red-500 font-bold');
                    respect -= 15;
                    budget -= 5000;
                }
            }

            // RESULT
            setTimeout(() => {
                const winMoney = budget >= 30000; // Lower threshold due to spending
                const winRespect = respect >= 60;
                const won = winMoney && winRespect;

                document.getElementById('final-money').innerText = budget.toLocaleString() + '‚Ç¨';
                document.getElementById('final-respect').innerText = respect;
                document.getElementById('bar-money').style.width = Math.min((budget / 80000) * 100, 100) + '%';
                document.getElementById('bar-respect').style.width = Math.min(respect, 100) + '%';

                const title = document.getElementById('result-title');
                const sub = document.getElementById('result-subtitle');

                if (won) {
                    title.innerText = "VICTORY ROYALE! üèÜ";
                    title.className = "text-5xl font-bold mb-2 uppercase tracking-tighter text-neon-green animate-bounce";
                    sub.innerText = "Festival Llegendari. Ets un geni.";
                    confetti({ particleCount: 300, spread: 120, zIndex: 999 });
                } else {
                    title.innerText = "GAME OVER üíÄ";
                    title.className = "text-5xl font-bold mb-2 uppercase tracking-tighter text-red-500";
                    let reason = !winMoney ? "T'has arru√Ønat." : "La reputaci√≥ pel terra.";
                    sub.innerText = reason + " Torna-ho a provar.";
                }
            }, 6000);
        }

        // Setup QR
        function generateQR() {
            // Simplified for inline script
        }
    </script>
</body>

</html>